# LAB 01: ê¸°ë³¸ TLS ì—°ê²° ì´í•´í•˜ê¸°

## ğŸ¯ í•™ìŠµ ëª©í‘œ
- TLS/SSLì˜ ê¸°ë³¸ ê°œë…ê³¼ ë™ì‘ ì›ë¦¬ ì´í•´
- ì¸ì¦ì„œ ì²´ì¸ì˜ êµ¬ì¡° íŒŒì•…
- Javaì—ì„œ HTTPS ì—°ê²°ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì›ì¸ ì´í•´

## ğŸ“š ì˜ˆìƒ ì†Œìš” ì‹œê°„: 30ë¶„

---

# Part 1: TLS/SSL ì´ë¡ 

## 1.1 TLSë€ ë¬´ì—‡ì¸ê°€?

### ë°°ê²½
ì¸í„°ë„· ì´ˆê¸°ì—ëŠ” ëª¨ë“  í†µì‹ ì´ í‰ë¬¸(Plain Text)ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. 
HTTPë¡œ ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë©´ ì¤‘ê°„ì—ì„œ ëˆ„êµ¬ë‚˜ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆì—ˆì£ .

```
[ë¸Œë¼ìš°ì €] ----"ë¹„ë°€ë²ˆí˜¸: 1234"----> [ì„œë²„]
                â†‘
            í•´ì»¤ê°€ ë³¼ ìˆ˜ ìˆìŒ!
```

### TLSì˜ ì—­í• 
TLS(Transport Layer Security)ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤:

```
[ë¸Œë¼ìš°ì €] ----"@#$%^&*ì•”í˜¸í™”ë¨"----> [ì„œë²„]
                â†‘
            í•´ì»¤ê°€ ë´ë„ ì˜ë¯¸ì—†ìŒ
```

### SSL vs TLS
- **SSL** (Secure Sockets Layer): ë„·ìŠ¤ì¼€ì´í”„ê°€ 1990ë…„ëŒ€ ê°œë°œ. SSL 3.0ê¹Œì§€ ë‚˜ì˜´
- **TLS** (Transport Layer Security): SSLì˜ í›„ì†. í˜„ì¬ TLS 1.3ì´ ìµœì‹ 
- ì‹¤ë¬´ì—ì„œëŠ” "SSL"ê³¼ "TLS"ë¥¼ í˜¼ìš©í•˜ì§€ë§Œ, ê¸°ìˆ ì ìœ¼ë¡œëŠ” TLSê°€ ì •í™•í•œ í‘œí˜„

```
SSL 1.0 (ë¯¸ì¶œì‹œ) â†’ SSL 2.0 â†’ SSL 3.0 â†’ TLS 1.0 â†’ TLS 1.1 â†’ TLS 1.2 â†’ TLS 1.3
                    (ì·¨ì•½)     (ì·¨ì•½)     (íê¸°)    (íê¸°)    (í˜„ì¬ì‚¬ìš©)  (ê¶Œì¥)
```

## 1.2 TLSê°€ ì œê³µí•˜ëŠ” 3ê°€ì§€ ë³´ì•ˆ

### 1) ê¸°ë°€ì„± (Confidentiality)
- ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì œ3ìê°€ ì½ì„ ìˆ˜ ì—†ê²Œ í•¨
- ëŒ€ì¹­í‚¤ ì•”í˜¸í™” ì‚¬ìš© (AES-GCM ë“±)

### 2) ë¬´ê²°ì„± (Integrity)  
- ë°ì´í„°ê°€ ì „ì†¡ ì¤‘ ë³€ì¡°ë˜ì§€ ì•Šì•˜ìŒì„ ë³´ì¥
- MAC (Message Authentication Code) ì‚¬ìš©

### 3) ì¸ì¦ (Authentication)
- í†µì‹  ìƒëŒ€ë°©ì´ ì§„ì§œì¸ì§€ í™•ì¸
- **ë””ì§€í„¸ ì¸ì¦ì„œ**ë¡œ ì‹ ì› ì¦ëª… â† ì˜¤ëŠ˜ ì‹¤ìŠµì˜ í•µì‹¬!

## 1.3 TLS í•¸ë“œì…°ì´í¬ ê³¼ì •

í´ë¼ì´ì–¸íŠ¸(ë¸Œë¼ìš°ì €)ì™€ ì„œë²„ê°€ ì•”í˜¸í™” í†µì‹ ì„ ì‹œì‘í•˜ê¸° ì „ "ì•…ìˆ˜"ë¥¼ í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   í´ë¼ì´ì–¸íŠ¸   â”‚                              â”‚     ì„œë²„      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                             â”‚
       â”‚  1. ClientHello                             â”‚
       â”‚  (ì§€ì›í•˜ëŠ” TLS ë²„ì „, ì•”í˜¸í™” ë°©ì‹ ëª©ë¡)         â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                             â”‚
       â”‚  2. ServerHello                             â”‚
       â”‚  (ì„ íƒëœ TLS ë²„ì „, ì•”í˜¸í™” ë°©ì‹)               â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                                             â”‚
       â”‚  3. Certificate                             â”‚
       â”‚  (ì„œë²„ì˜ ì¸ì¦ì„œ ì²´ì¸) â† â˜… í•µì‹¬!              â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                                             â”‚
       â”‚  4. í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ì¦ì„œ ê²€ì¦                  â”‚
       â”‚  - ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CAê°€ ì„œëª…í–ˆë‚˜?              â”‚
       â”‚  - ìœ íš¨ê¸°ê°„ì´ ì§€ë‚˜ì§€ ì•Šì•˜ë‚˜?                  â”‚
       â”‚  - í˜¸ìŠ¤íŠ¸ëª…ì´ ì¼ì¹˜í•˜ë‚˜?                      â”‚
       â”‚                                             â”‚
       â”‚  5. Key Exchange                            â”‚
       â”‚  (ì•”í˜¸í™”ì— ì‚¬ìš©í•  í‚¤ êµí™˜)                    â”‚
       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                                             â”‚
       â”‚  6. Finished                                â”‚
       â”‚  (í•¸ë“œì…°ì´í¬ ì™„ë£Œ, ì•”í˜¸í™” í†µì‹  ì‹œì‘)           â”‚
       â”‚<â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚
       â”‚         ì´í›„ ëª¨ë“  ë°ì´í„°ëŠ” ì•”í˜¸í™”ë¨            â”‚
```

## 1.4 ì¸ì¦ì„œ(Certificate)ë€?

### ë””ì§€í„¸ ì¸ì¦ì„œì˜ ì—­í• 
ì‹¤ìƒí™œì—ì„œ ì‹ ë¶„ì¦ì´ "ì´ ì‚¬ëŒì´ í™ê¸¸ë™ì´ ë§ë‹¤"ê³  ì¦ëª…í•˜ë“¯,
ë””ì§€í„¸ ì¸ì¦ì„œëŠ” "ì´ ì„œë²„ê°€ google.comì´ ë§ë‹¤"ê³  ì¦ëª…í•©ë‹ˆë‹¤.

### ì¸ì¦ì„œì— í¬í•¨ëœ ì •ë³´ (X.509 í˜•ì‹)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë””ì§€í„¸ ì¸ì¦ì„œ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject (ì£¼ì²´)      : CN=www.google.com               â”‚
â”‚  Issuer (ë°œê¸‰ì)     : CN=GTS CA 1C3, O=Google Trust   â”‚
â”‚  Valid From          : 2024-01-01                      â”‚
â”‚  Valid To            : 2024-03-31                      â”‚
â”‚  Public Key          : RSA 2048-bit                    â”‚
â”‚  Subject Alt Names   : DNS:www.google.com,             â”‚
â”‚                        DNS:*.google.com                â”‚
â”‚  Serial Number       : 01:23:45:67:89:AB:CD:EF        â”‚
â”‚  Signature Algorithm : SHA256withRSA                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Digital Signature   : (ë°œê¸‰ìì˜ ê°œì¸í‚¤ë¡œ ì„œëª…ë¨)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” í•„ë“œ ì„¤ëª…
- **Subject**: ì¸ì¦ì„œ ì†Œìœ ì (CN = Common Name)
- **Issuer**: ì¸ì¦ì„œë¥¼ ë°œê¸‰í•œ CA (Certificate Authority)
- **SAN (Subject Alternative Names)**: ì´ ì¸ì¦ì„œê°€ ìœ íš¨í•œ ë„ë©”ì¸ ëª©ë¡
- **Digital Signature**: CAê°€ "ì´ ë‚´ìš©ì´ ì§„ì§œë‹¤"ë¼ê³  ì„œëª…í•œ ê²ƒ

## 1.5 ì¸ì¦ì„œ ì²´ì¸ (Certificate Chain)

### ì™œ ì²´ì¸ì´ í•„ìš”í•œê°€?

ë¬¸ì œ: ë¸Œë¼ìš°ì €ê°€ ëª¨ë“  ì›¹ì‚¬ì´íŠ¸ì˜ ì¸ì¦ì„œë¥¼ ë¯¸ë¦¬ ì•Œ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.
í•´ê²°: **ì‹ ë¢°ì˜ ì²´ì¸**ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ì‹ ë¢°ì˜ ì²´ì¸                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚    Root CA      â”‚  â† ë¸Œë¼ìš°ì €/OSì— ë¯¸ë¦¬ ì„¤ì¹˜ë¨ (ì•½ 100ê°œ)     â”‚
â”‚  â”‚  (DigiCert ë“±)   â”‚     "ë¬´ì¡°ê±´ ì‹ ë¢°"                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚           â”‚ ì„œëª…                                                â”‚
â”‚           â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ Intermediate CA â”‚  â† Rootê°€ ì„œëª…í–ˆìœ¼ë¯€ë¡œ ì‹ ë¢°                 â”‚
â”‚  â”‚   (ì¤‘ê°„ CA)      â”‚     ì‹¤ì œ ì¸ì¦ì„œ ë°œê¸‰ ë‹´ë‹¹                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚           â”‚ ì„œëª…                                                â”‚
â”‚           â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ Server Cert     â”‚  â† ì¤‘ê°„ CAê°€ ì„œëª…í–ˆìœ¼ë¯€ë¡œ ì‹ ë¢°              â”‚
â”‚  â”‚ (www.google.com)â”‚     ì›¹ì‚¬ì´íŠ¸ê°€ ì‚¬ìš©                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²€ì¦ ê³¼ì •
1. ì„œë²„ê°€ [ì„œë²„ ì¸ì¦ì„œ] + [ì¤‘ê°„ CA ì¸ì¦ì„œ]ë¥¼ ë³´ëƒ„
2. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ ì¸ì¦ì„œì˜ ì„œëª…ì„ ì¤‘ê°„ CAì˜ ê³µê°œí‚¤ë¡œ ê²€ì¦
3. ì¤‘ê°„ CA ì¸ì¦ì„œì˜ ì„œëª…ì„ Root CAì˜ ê³µê°œí‚¤ë¡œ ê²€ì¦
4. Root CAëŠ” ì´ë¯¸ ì‹ ë¢°í•˜ë¯€ë¡œ â†’ ì „ì²´ ì²´ì¸ ì‹ ë¢°!

## 1.6 Javaì˜ TrustStore (cacerts)

### TrustStoreë€?
Javaê°€ "ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA ëª©ë¡"ì„ ì €ì¥í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤.

```
ìœ„ì¹˜: $JAVA_HOME/lib/security/cacerts
í˜•ì‹: JKS ë˜ëŠ” PKCS12
ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: changeit
```

### Java HTTPS ì—°ê²° íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Java HTTPS ì—°ê²°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Java Application                                               â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”‚ new URL("https://google.com").openConnection()         â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ SSLContext  â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚TrustManager â”‚â”€â”€â”€â”€>â”‚ TrustStore      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ (cacerts íŒŒì¼)   â”‚                       â”‚
â”‚         â”‚            â”‚ - DigiCert Root â”‚                       â”‚
â”‚         â”‚            â”‚ - GlobalSign    â”‚                       â”‚
â”‚         â”‚            â”‚ - Let's Encrypt â”‚                       â”‚
â”‚         â”‚            â”‚ - ...ì•½ 90ê°œ     â”‚                       â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  ì„œë²„ ì¸ì¦ì„œê°€ cacertsì˜ CAë¡œ ì„œëª…ë˜ì—ˆë‚˜?                         â”‚
â”‚         â”‚                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                                  â”‚
â”‚    â”‚         â”‚                                                  â”‚
â”‚   Yes        No                                                 â”‚
â”‚    â”‚         â”‚                                                  â”‚
â”‚    â–¼         â–¼                                                  â”‚
â”‚  ì—°ê²° ì„±ê³µ   SSLHandshakeException                              â”‚
â”‚             "PKIX path building failed"                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 2: ì‹¤ìŠµ í™˜ê²½ ì ‘ì†

## 2.1 Java ì‹¤ìŠµ Pod ì ‘ì†

```powershell
# Windows PowerShellì—ì„œ ì‹¤í–‰
kubectl exec -it -n tls-lab deploy/java-tls-lab -- /bin/bash
```

ì„±ê³µí•˜ë©´ ì´ëŸ° í”„ë¡¬í”„íŠ¸ê°€ ë³´ì…ë‹ˆë‹¤:
```
root@java-tls-lab-xxxxx:/# 
```

## 2.2 í™˜ê²½ í™•ì¸

```bash
# Java ë²„ì „ í™•ì¸
java -version

# ì¶œë ¥ ì˜ˆì‹œ:
# openjdk version "21.0.x" 2024-xx-xx
# OpenJDK Runtime Environment Temurin-21...

# JAVA_HOME í™•ì¸
echo $JAVA_HOME
# ì¶œë ¥: /opt/java/openjdk

# ì‘ì—… ë””ë ‰í† ë¦¬ í™•ì¸
ls /workspace/
# ì¶œë ¥: certs  java-app  logs
```

## 2.3 ê¸°ë³¸ cacerts í™•ì¸

```bash
# cacerts íŒŒì¼ ìœ„ì¹˜ í™•ì¸
ls -la $JAVA_HOME/lib/security/cacerts

# cacertsì— ë“¤ì–´ìˆëŠ” CA ê°œìˆ˜ í™•ì¸
keytool -list -keystore $JAVA_HOME/lib/security/cacerts \
  -storepass changeit 2>/dev/null | grep -c "trustedCertEntry"

# ì¶œë ¥ ì˜ˆì‹œ: 90 (ì•½ 90ê°œì˜ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA)
```

### ğŸ’¡ ì°¸ê³ : keytoolì´ë€?
Javaì— í¬í•¨ëœ í‚¤/ì¸ì¦ì„œ ê´€ë¦¬ ë„êµ¬ì…ë‹ˆë‹¤.
```
keytool ì£¼ìš” ëª…ë ¹ì–´:
  -list       : KeyStore ë‚´ìš© ì¡°íšŒ
  -importcert : ì¸ì¦ì„œ ì¶”ê°€
  -delete     : ì¸ì¦ì„œ ì‚­ì œ
  -genkeypair : í‚¤ ìŒ ìƒì„±
```

---

# Part 3: ë‚´ë¶€ TLS ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸

## 3.1 ë‚´ë¶€ TLS ì„œë²„ í™•ì¸

ìš°ë¦¬ê°€ ë°°í¬í•œ NGINX TLS ì„œë²„ê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# TLS ì„œë²„ DNS í™•ì¸
nslookup tls-server.tls-lab.svc.cluster.local

# HTTPë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸ (ë¦¬ë‹¤ì´ë ‰íŠ¸ë¨)
curl -I http://tls-server.tls-lab.svc.cluster.local

# ì¶œë ¥:
# HTTP/1.1 301 Moved Permanently
# Location: https://tls-server.tls-lab.svc.cluster.local/
```

## 3.2 OpenSSLë¡œ TLS í•¸ë“œì…°ì´í¬ ê´€ì°°

```bash
# TLS ì—°ê²° ë° ì¸ì¦ì„œ í™•ì¸
openssl s_client -connect tls-server.tls-lab.svc.cluster.local:443 \
  -showcerts </dev/null 2>/dev/null | head -50
```

### ì¶œë ¥ ë¶„ì„
```
CONNECTED(00000003)
---
Certificate chain                          â† ì¸ì¦ì„œ ì²´ì¸ ì‹œì‘
 0 s:CN = tls-server.tls-lab.svc.cluster.local    â† ì„œë²„ ì¸ì¦ì„œ
   i:CN = tls-lab-ca                              â† ë°œê¸‰ì: ë‚´ë¶€ CA
-----BEGIN CERTIFICATE-----
MIIDxTCCAq2gAwIBAgIRAKQ...                       â† ì„œë²„ ì¸ì¦ì„œ (Base64)
-----END CERTIFICATE-----
 1 s:CN = tls-lab-ca                              â† ì¤‘ê°„/ë£¨íŠ¸ CA
   i:CN = tls-lab-ca                              â† Self-Signed (ìì²´ ì„œëª…)
-----BEGIN CERTIFICATE-----
MIIDkzCCAnugAwIBAgIQV...                         â† CA ì¸ì¦ì„œ (Base64)
-----END CERTIFICATE-----
---
Server certificate                         
subject=CN = tls-server.tls-lab.svc.cluster.local
issuer=CN = tls-lab-ca
---
...
SSL-Session:
    Protocol  : TLSv1.3                    â† ì‚¬ìš©ëœ í”„ë¡œí† ì½œ
    Cipher    : TLS_AES_256_GCM_SHA384     â† ì‚¬ìš©ëœ ì•”í˜¸í™” ë°©ì‹
```

### í•µì‹¬ í¬ì¸íŠ¸
- **s:** = Subject (ì´ ì¸ì¦ì„œì˜ ì£¼ì²´)
- **i:** = Issuer (ì´ ì¸ì¦ì„œë¥¼ ë°œê¸‰í•œ CA)
- ìš°ë¦¬ ë‚´ë¶€ CA(`tls-lab-ca`)ê°€ Self-Signed (sì™€ iê°€ ë™ì¼)

## 3.3 ì¸ì¦ì„œ ìƒì„¸ ì •ë³´ í™•ì¸

```bash
# ì„œë²„ ì¸ì¦ì„œë§Œ ì¶”ì¶œ
openssl s_client -connect tls-server.tls-lab.svc.cluster.local:443 \
  </dev/null 2>/dev/null | openssl x509 -noout -text | head -40
```

### ì£¼ìš” í•„ë“œ í™•ì¸
```
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: ...
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN = tls-lab-ca                    â† ë°œê¸‰ì
        Validity
            Not Before: Jan 15 10:30:00 2025 GMT  â† ìœ íš¨ ì‹œì‘ì¼
            Not After : Apr 15 10:30:00 2025 GMT  â† ë§Œë£Œì¼
        Subject: CN = tls-server.tls-lab.svc.cluster.local
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
            RSA Public-Key: (2048 bit)            â† í‚¤ í¬ê¸°
        X509v3 extensions:
            X509v3 Subject Alternative Name:       â† SAN ëª©ë¡
                DNS:tls-server, 
                DNS:tls-server.tls-lab,
                DNS:tls-server.tls-lab.svc,
                DNS:tls-server.tls-lab.svc.cluster.local,
                DNS:localhost,
                IP Address:127.0.0.1
```

## 3.4 curlë¡œ HTTPS ì—°ê²° í…ŒìŠ¤íŠ¸

```bash
# ë‚´ë¶€ CAë¥¼ ì‹ ë¢°í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì‹¤íŒ¨
curl https://tls-server.tls-lab.svc.cluster.local

# ì¶œë ¥:
# curl: (60) SSL certificate problem: unable to get local issuer certificate

# -k ì˜µì…˜ìœ¼ë¡œ ì¸ì¦ì„œ ê²€ì¦ ë¬´ì‹œ (í…ŒìŠ¤íŠ¸ìš©)
curl -k https://tls-server.tls-lab.svc.cluster.local

# ì¶œë ¥:
# {"status":"ok","message":"TLS connection successful",...}
```

### âš ï¸ ì¤‘ìš”
`-k` ë˜ëŠ” `--insecure` ì˜µì…˜ì€ **í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œë§Œ** ì‚¬ìš©í•˜ì„¸ìš”.
ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ì´ ì˜µì…˜ì„ ì“°ë©´ ì¤‘ê°„ì ê³µê²©(MITM)ì— ì·¨ì•½í•´ì§‘ë‹ˆë‹¤.

---

# Part 4: Javaì—ì„œ TLS ì—°ê²°

## 4.1 ê¸°ë³¸ TrustStoreë¡œ ì™¸ë¶€ ì‚¬ì´íŠ¸ ì—°ê²°

ë¨¼ì € ê¸°ë³¸ cacertsë¡œ ì™¸ë¶€ ì‚¬ì´íŠ¸(google.com)ì— ì—°ê²°í•´ë´…ë‹ˆë‹¤.

```bash
cd /workspace/java-app

# Java TLS í…ŒìŠ¤íŠ¸ ì‹¤í–‰
java TLSConnectionTest https://www.google.com
```

### ì˜ˆìƒ ì¶œë ¥
```
ğŸ” Testing TLS connection to: https://www.google.com
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… TLS Connection Successful!
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Protocol:     TLSv1.3
Cipher Suite: TLS_AES_256_GCM_SHA384
Peer Host:    www.google.com

ğŸ“œ Certificate Chain (3 certs):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[0] Server Certificate:
    Subject: CN=www.google.com
    Issuer:  CN=GTS CA 1C3,O=Google Trust Services LLC,C=US
    Valid:   Mon Jan 01 ... ~ Wed Mar 31 ...

[1] Intermediate Certificate:
    Subject: CN=GTS CA 1C3,O=Google Trust Services LLC,C=US
    Issuer:  CN=GTS Root R1,O=Google Trust Services LLC,C=US

[2] Root CA Certificate:
    Subject: CN=GTS Root R1,O=Google Trust Services LLC,C=US
    Issuer:  CN=GTS Root R1,O=Google Trust Services LLC,C=US   â† Self-Signed

ğŸ“¡ HTTP Response: 200
âœ… Test completed successfully!
```

### ì™œ ì„±ê³µí–ˆë‚˜?
1. Googleì˜ Root CA (`GTS Root R1`)ê°€ Javaì˜ ê¸°ë³¸ cacertsì— í¬í•¨ë˜ì–´ ìˆìŒ
2. Javaê°€ ì¸ì¦ì„œ ì²´ì¸ì„ ê²€ì¦:
   - www.google.com ì¸ì¦ì„œ â†’ GTS CA 1C3ì´ ì„œëª… âœ“
   - GTS CA 1C3 ì¸ì¦ì„œ â†’ GTS Root R1ì´ ì„œëª… âœ“
   - GTS Root R1 â†’ cacertsì— ìˆìŒ âœ“
3. ì²´ì¸ ì „ì²´ê°€ ì‹ ë¢°ë¨ â†’ ì—°ê²° ì„±ê³µ!

## 4.2 ê¸°ë³¸ TrustStoreë¡œ ë‚´ë¶€ ì„œë²„ ì—°ê²° (ì‹¤íŒ¨ ì˜ˆìƒ)

```bash
java TLSConnectionTest https://tls-server.tls-lab.svc.cluster.local
```

### ì˜ˆìƒ ì¶œë ¥
```
ğŸ” Testing TLS connection to: https://tls-server.tls-lab.svc.cluster.local
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ SSL Handshake Failed!
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Error: PKIX path building failed: 
  sun.security.provider.certpath.SunCertPathBuilderException: 
  unable to find valid certification path to requested target

ğŸ’¡ Possible causes:
   - Server certificate not trusted
   - Root CA not in truststore
   - Certificate expired
   - Hostname mismatch

ğŸ”§ Try adding the root CA to your truststore:
   keytool -importcert -keystore ./test-cacerts -alias <alias> -file <ca.crt>
```

### ì™œ ì‹¤íŒ¨í–ˆë‚˜?
1. ë‚´ë¶€ ì„œë²„ì˜ CA (`tls-lab-ca`)ëŠ” ìš°ë¦¬ê°€ ë§Œë“  ìì²´ CA
2. Javaì˜ ê¸°ë³¸ cacertsì—ëŠ” ì´ CAê°€ ì—†ìŒ
3. ì¸ì¦ì„œ ì²´ì¸ ê²€ì¦ ì‹¤íŒ¨ â†’ SSLHandshakeException!

## 4.3 ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤íŒ¨ ì›ì¸ ìƒì„¸ ë¶„ì„

```bash
java -Djavax.net.debug=ssl:handshake \
  TLSConnectionTest https://tls-server.tls-lab.svc.cluster.local 2>&1 | head -100
```

### í•µì‹¬ ë¡œê·¸ ë¶„ì„
```
javax.net.ssl|DEBUG|...
"CertificateMessage": {
  "certificates": [{
    "certificate" : {
      "subject": "CN=tls-server.tls-lab.svc.cluster.local",
      "issuer": "CN=tls-lab-ca",
      ...
    }
  }]
}

javax.net.ssl|ERROR|...
"Certificate chain validation failed"
"sun.security.validator.ValidatorException: PKIX path building failed"
```

ì´ ë¡œê·¸ëŠ” Javaê°€ ì¸ì¦ì„œë¥¼ ë°›ì•˜ì§€ë§Œ, ë°œê¸‰ì(tls-lab-ca)ë¥¼ ì‹ ë¢°í•  ìˆ˜ ì—†ì–´ì„œ 
ê²€ì¦ì— ì‹¤íŒ¨í–ˆë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

---

# Part 5: í•µì‹¬ ê°œë… ì •ë¦¬

## 5.1 ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ

### TLSì˜ 3ê°€ì§€ ë³´ì•ˆ
| ë³´ì•ˆ ìš”ì†Œ | ì„¤ëª… | êµ¬í˜„ ë°©ì‹ |
|----------|------|----------|
| ê¸°ë°€ì„± | ë°ì´í„° ì•”í˜¸í™” | AES-GCM |
| ë¬´ê²°ì„± | ë³€ì¡° ë°©ì§€ | HMAC |
| ì¸ì¦ | ì‹ ì› í™•ì¸ | X.509 ì¸ì¦ì„œ |

### ì¸ì¦ì„œ ì²´ì¸
```
Root CA (cacertsì— ìˆìŒ)
    â†“ ì„œëª…
Intermediate CA
    â†“ ì„œëª…
Server Certificate
```

### Java TrustStore
- ìœ„ì¹˜: `$JAVA_HOME/lib/security/cacerts`
- ì—­í• : ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CA ëª©ë¡ ì €ì¥
- ì¸ì¦ì„œê°€ ì—¬ê¸° ìˆëŠ” CAë¡œ ì„œëª…ë˜ì–´ì•¼ ì—°ê²° ì„±ê³µ

## 5.2 ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬

| ì—ëŸ¬ ë©”ì‹œì§€ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------------|------|----------|
| PKIX path building failed | Root CAê°€ TrustStoreì— ì—†ìŒ | CA ì¸ì¦ì„œ ì¶”ê°€ |
| Certificate has expired | ì¸ì¦ì„œ ë§Œë£Œ | ìƒˆ ì¸ì¦ì„œ ë°œê¸‰ |
| Hostname verification failed | CN/SAN ë¶ˆì¼ì¹˜ | ì˜¬ë°”ë¥¸ ë„ë©”ì¸ìœ¼ë¡œ ì¸ì¦ì„œ ì¬ë°œê¸‰ |

## 5.3 ë‹¤ìŒ ì‹¤ìŠµ ì˜ˆê³ 

**LAB 02: ì¸ì¦ì„œ ì‹ ë¢° ì²´ì¸ ì‹¤ìŠµ**ì—ì„œëŠ”:
- í…ŒìŠ¤íŠ¸ìš© TrustStore ìƒì„±
- ë‚´ë¶€ CAë¥¼ TrustStoreì— ì¶”ê°€
- ì—°ê²° ì„±ê³µ í™•ì¸
- ì¤‘ê°„ CA vs Root CA ì°¨ì´ ì‹¤ìŠµ

---

# ğŸ“ ì‹¤ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] TLSê°€ ì œê³µí•˜ëŠ” 3ê°€ì§€ ë³´ì•ˆ ì´í•´
- [ ] ì¸ì¦ì„œ ì²´ì¸ì˜ êµ¬ì¡° ì´í•´
- [ ] Java ì‹¤ìŠµ Pod ì ‘ì† ì„±ê³µ
- [ ] opensslë¡œ TLS í•¸ë“œì…°ì´í¬ ê´€ì°°
- [ ] ì™¸ë¶€ ì‚¬ì´íŠ¸(google.com) ì—°ê²° ì„±ê³µ
- [ ] ë‚´ë¶€ ì„œë²„ ì—°ê²° ì‹¤íŒ¨ ë° ì›ì¸ ì´í•´

---

## ğŸ”— ë‹¤ìŒ ì‹¤ìŠµ
[LAB-02-ì¸ì¦ì„œ-ì‹ ë¢°ì²´ì¸.md](./LAB-02-ì¸ì¦ì„œ-ì‹ ë¢°ì²´ì¸.md)
